!function(u){"use strict";var _,p,v=null,w=[],g=[],c=null,T=0,b=0,y={calcStringTime:function(i){var e=i.split(":");return 60*Number(e[0])*60+60*Number(e[1])},formatTime:function(i){return""+(i/36e3|0)+(i/3600%10|0)+":"+(""+(i%3600/600|0)+(i%3600/60%10|0))},scheduleData:function(){return w},timelineData:function(){var i,e=[];for(i in g)e[i]=g[i],e[i].schedule=[];for(i in w){var t=w[i];void 0!==t.timeline&&void 0!==e[t.timeline]&&e[t.timeline].schedule.push(t)}return e},resetData:function(){for(var i in w=[],_.find(".sc_bar").remove(),g)g[i].schedule=[],y._resizeRow.apply(this,[i,0]);return this},addSchedule:function(i,e){var t={start:y.calcStringTime(e.start),end:y.calcStringTime(e.end),text:e.text,timeline:i};return e.data&&(t.data=e.data),y._addScheduleData.apply(this,[i,t]),y._resetBarPosition.apply(this,[i]),this},addRow:function(i,e){return y._addRow.apply(this,[i,e]),this},resetRowData:function(){return w=[],g=[],_.find(".sc_bar").remove(),_.find(".timeline").remove(),_.find(".sc_data").height(0),this},setRows:function(i){for(var e in y.resetRowData.apply(this,[]),i)y.addRow.apply(this,[e,i[e]]);return this},setDraggable:function(i){var e=!!i;e!==v.draggable&&((v.draggable=e)?_.find(".sc_bar").draggable("enable"):_.find(".sc_bar").draggable("disable"))},setResizable:function(i){var e=!!i;e!==v.resizable&&((v.resizable=e)?_.find(".sc_bar").resizable("enable"):_.find(".sc_bar").resizable("disable"))},_getTimeLineNumber:function(i){var e=0,t=0,n=Math.ceil(i/(v.timeLineY+v.timeLinePaddingTop+v.timeLinePaddingBottom));for(var a in v.rows){var d=v.rows[a],s=0;if("object"==typeof d.schedule&&(s=d.schedule.length),c&&c.timeline&&s++,n<=(t+=Math.max(s,1)))break;e++}return e},_addScheduleBgData:function(i){var e=Math.ceil((i.start-T)/v.widthTime),t=Math.floor((i.end-T)/v.widthTime),n=u('<div class="sc_bgBar"><span class="text"></span></div>');n.css({left:e*v.widthTimeX,top:0,width:(t-e)*v.widthTimeX,height:_.find(".sc_main .timeline").eq(i.timeline).height()}),i.text&&n.find(".text").text(i.text),i.class&&n.addClass(i.class),_.find(".sc_main .timeline").eq(i.timeline).append(n)},_addScheduleData:function(i,e){var t=Math.ceil((e.start-T)/v.widthTime),n=Math.floor((e.end-T)/v.widthTime),a=u('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),d=y.formatTime(e.start),s=y.formatTime(e.end),r=y._getScheduleCount.apply(p,[e.timeline]);a.css({left:t*v.widthTimeX,top:r*v.timeLineY+v.timeLinePaddingTop,width:(n-t)*v.widthTimeX,height:v.timeLineY}),a.find(".time").text(d+"-"+s),e.text&&a.find(".text").text(e.text),e.class&&a.addClass(e.class),_.find(".sc_main .timeline").eq(i).append(a),w.push(e),v.onAppendSchedule&&v.onAppendSchedule(a,e);var o=w.length-1;a.data("sc_key",o),a.bind("mouseup",function(){if(v.onClick&&!0!==u(this).data("dragCheck")&&!0!==u(this).data("resizeCheck")){var i=u(this),e=i.data("sc_key");v.onClick(i,w[e])}});var l=_.find(".sc_bar");return l.draggable({grid:[v.widthTimeX,1],containment:".sc_main",helper:"original",start:function(i,e){var t={};t.node=this,t.offsetTop=e.position.top,t.offsetLeft=e.position.left,t.currentTop=e.position.top,t.currentLeft=e.position.left,t.timeline=y._getTimeLineNumber.apply(p,[e.position.top]),t.nowTimeline=t.timeline,c=t},drag:function(i,e){if(u(this).data("dragCheck",!0),!c)return!1;var t=u(this),n=t.data("sc_key"),a=y._getTimeLineNumber.apply(p,[e.position.top]);return e.position.left=Math.floor(e.position.left/v.widthTimeX)*v.widthTimeX,c.nowTimeline!==a&&(c.nowTimeline=a),c.currentTop=e.position.top,c.currentLeft=e.position.left,y._rewriteBarText.apply(p,[t,w[n]]),!0},stop:function(){u(this).data("dragCheck",!1),c=null;var i=u(this),e=i.data("sc_key"),t=i.position().left,n=T+Math.floor(t/v.widthTimeX)*v.widthTime,a=n+(w[e].end-w[e].start);w[e].start=n,w[e].end=a,v.onChange&&v.onChange(i,w[e])}}),l.resizable({handles:"e",grid:[v.widthTimeX,v.timeLineY],minWidth:v.widthTimeX,start:function(){u(this).data("resizeCheck",!0)},resize:function(i,e){e.element.height(e.size.height),e.element.width(e.size.width)},stop:function(){var i=u(this),e=i.data("sc_key"),t=i.position().left,n=i.outerWidth(),a=T+Math.floor(t/v.widthTimeX)*v.widthTime,d=T+Math.floor((t+n)/v.widthTimeX)*v.widthTime,s=w[e].timeline;w[e].start=a,w[e].end=d,y._resetBarPosition.apply(p,[s]),y._rewriteBarText.apply(p,[i,w[e]]),i.data("resizeCheck",!1),v.onChange&&v.onChange(i,w[e])}}),!1===v.draggable&&l.draggable("disable"),!1===v.resizable&&l.resizable("disable"),o},_getScheduleCount:function(i){var e=0;for(var t in w)w[t].timeline===i&&e++;return e},_addRow:function(i,e){var t,n=e.title,a=_.find(".sc_main .timeline").length;t="";var d=u(t+='<div class="timeline"><span>'+n+"</span></div>");v.onInitRow&&v.onInitRow(d,e),_.find(".sc_data_scroll").append(d),t="";for(var s=u(t+='<div class="timeline"></div>'),r=T;r<b;r+=v.widthTime){var o=u('<div class="tl"></div>');o.outerWidth(v.widthTimeX),o.data("time",y.formatTime(r)),o.data("timeline",i),s.append(o)}if(s.find(".tl").click(function(){v.onScheduleClick&&v.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),g[u(this).data("timeline")])}),s.find(".tl").on("contextmenu",function(){return v.onScheduleClick&&v.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),g[u(this).data("timeline")]),!1}),_.find(".sc_main").append(s),(g[i]=e).class&&""!==e.class&&(_.find(".sc_data .timeline").eq(a).addClass(e.class),_.find(".sc_main .timeline").eq(a).addClass(e.class)),e.schedule)for(var l in e.schedule){var c=e.schedule[l],h=y.calcStringTime(c.start),m=y.calcStringTime(c.end),f={};f.start=h,f.end=m,c.text&&(f.text=c.text),f.timeline=l,f.data={},c.data&&(f.data=c.data),y._addScheduleData.apply(p,[a,f])}y._resetBarPosition.apply(p,[a]),_.find(".sc_main .timeline").eq(a).droppable({accept:".sc_bar",drop:function(i,e){var t=e.draggable,n=t.data("sc_key"),a=w[n].timeline,d=_.find(".sc_main .timeline").index(this);w[n].timeline=d,t.appendTo(this),y._resetBarPosition.apply(p,[a]),y._resetBarPosition.apply(p,[d])}}),v.onAppendRow&&_.find(".sc_main .timeline").eq(a).find(".sc_bar").each(function(){var i=u(this),e=i.data("sc_key");v.onAppendRow(i,w[e])})},_rewriteBarText:function(i,e){var t=i.position().left,n=T+Math.floor(t/v.widthTimeX)*v.widthTime,a=n+(e.end-e.start),d=y.formatTime(n)+"-"+y.formatTime(a);u(i).find(".time").html(d)},_resetBarPosition:function(i){var e,t,n,a,d,s,r,o,l=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),c=[],h=[],m=0;for(o=0;o<l.length;o++)c[o]={code:o,x:u(l[o]).position().left};for(c.sort(function(i,e){return i.x<e.x?-1:i.x>e.x?1:0}),o=0;o<c.length;o++){for(n=c[o].code,e=u(l[n]),m=0;m<h.length;m++){for(var f=!1,p=0;p<h[m].length;p++)a=h[m][p],t=u(l[a]),d=e.position().left,r=e.position().left+e.outerWidth(),s=t.position().left,d<t.position().left+t.outerWidth()&&s<r&&(f=!0);if(!f)break}h[m]||(h[m]=[]),e.css({top:m*v.timeLineY+v.timeLinePaddingTop}),h[m][h[m].length]=n}y._resizeRow.apply(this,[i,h.length])},_resizeRow:function(i,e){var t=Math.max(e,1);_.find(".sc_data .timeline").eq(i).height(t*v.timeLineY-v.timeLineBorder+v.timeLinePaddingTop+v.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).height(t*v.timeLineY-v.timeLineBorder+v.timeLinePaddingTop+v.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).find(".sc_bgBar").each(function(){u(this).height(u(this).closest(".timeline").height())}),_.find(".sc_data").height(_.find(".sc_main_box").height())},_resizeWindow:function(){var i=_.width()-v.dataWidth-v.verticalScrollbar,e=Math.floor((b-T)/v.widthTime);_.find(".sc_header_cell").width(v.dataWidth),_.find(".sc_data,.sc_data_scroll").width(v.dataWidth),_.find(".sc_header").width(i),_.find(".sc_main_box").width(i),_.find(".sc_header_scroll").width(v.widthTimeX*e),_.find(".sc_main_scroll").width(v.widthTimeX*e)},_moveSchedules:function(i,e,t){for(var n=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),a=0;a<n.length;a++){var d=u(n[a]);if(e.position().left<=d.position().left){var s=d.position().left+v.widthTimeX*t,r=Math.floor((b-T)/v.widthTime)*v.widthTimeX-d.outerWidth();d.css({left:Math.max(0,Math.min(s,r))});var o=d.data("sc_key"),l=T+Math.floor(d.position().left/v.widthTimeX)*v.widthTime,c=l+(w[o].end-w[o].start);w[o].start=l,w[o].end=c,y._rewriteBarText.apply(p,[d,w[o]]),v.onChange&&v.onChange(d,w[o])}}y._resetBarPosition.apply(p,[i])},init:function(i){_=u(this),p=this,v=u.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,draggable:!0,resizable:!0,onInitRow:null,onChange:null,onClick:null,onAppendRow:null,onAppendSchedule:null,onScheduleClick:null},i),T=y.calcStringTime(v.startTime),b=y.calcStringTime(v.endTime),T-=T%v.widthTime,b-=b%v.widthTime;var e='<div class="sc_menu">\n<div class="sc_header_cell"><span>&nbsp;</span></div>\n<div class="sc_header">\n<div class="sc_header_scroll"></div>\n</div>\n</div>\n<div class="sc_wrapper">\n<div class="sc_data">\n<div class="sc_data_scroll"></div>\n</div>\n<div class="sc_main_box">\n<div class="sc_main_scroll">\n<div class="sc_main"></div>\n</div>\n</div>\n</div>';_.append(e),_.addClass(v.className),_.find(".sc_main_box").scroll(function(){_.find(".sc_data_scroll").css("top",-1*u(this).scrollTop()),_.find(".sc_header_scroll").css("left",-1*u(this).scrollLeft())});for(var t=-1,n=T;n<b;n+=v.widthTime)if(t<0||Math.floor(t/3600)!==Math.floor(n/3600)){e="",e+='<div class="sc_time">'+y.formatTime(n)+"</div>";var a=u(e),d=Number(Math.min(3600*Math.ceil((n+v.widthTime)/3600),b)-n),s=Math.floor(d/v.widthTime);a.width(s*v.widthTimeX),_.find(".sc_header_scroll").append(a),t=n}for(var r in u(window).resize(function(){y._resizeWindow.apply(p)}).trigger("resize"),v.rows)y._addRow.apply(this,[r,v.rows[r]]);return this}};u.fn.timeSchedule=function(i){return y[i]?y[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(u.error("Method "+i+" does not exist on jQuery.timeSchedule"),this):y.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
